{"ast":null,"code":"import log from '../../utils/log';\nconst NO_PICKED_OBJECT = {\n  pickedColor: null,\n  pickedLayer: null,\n  pickedObjectIndex: -1\n};\nexport function getClosestObject(_ref) {\n  let {\n    pickedColors,\n    decodePickingColor,\n    deviceX,\n    deviceY,\n    deviceRadius,\n    deviceRect\n  } = _ref;\n\n  if (pickedColors) {\n    const {\n      x,\n      y,\n      width,\n      height\n    } = deviceRect;\n    let minSquareDistanceToCenter = deviceRadius * deviceRadius;\n    let closestPixelIndex = -1;\n    let i = 0;\n\n    for (let row = 0; row < height; row++) {\n      const dy = row + y - deviceY;\n      const dy2 = dy * dy;\n\n      if (dy2 > minSquareDistanceToCenter) {\n        i += 4 * width;\n      } else {\n        for (let col = 0; col < width; col++) {\n          const pickedLayerIndex = pickedColors[i + 3] - 1;\n\n          if (pickedLayerIndex >= 0) {\n            const dx = col + x - deviceX;\n            const d2 = dx * dx + dy2;\n\n            if (d2 <= minSquareDistanceToCenter) {\n              minSquareDistanceToCenter = d2;\n              closestPixelIndex = i;\n            }\n          }\n\n          i += 4;\n        }\n      }\n    }\n\n    if (closestPixelIndex >= 0) {\n      const pickedColor = pickedColors.slice(closestPixelIndex, closestPixelIndex + 4);\n      const pickedObject = decodePickingColor(pickedColor);\n\n      if (pickedObject) {\n        const dy = Math.floor(closestPixelIndex / 4 / width);\n        const dx = closestPixelIndex / 4 - dy * width;\n        return { ...pickedObject,\n          pickedColor,\n          pickedX: x + dx,\n          pickedY: y + dy\n        };\n      }\n\n      log.error('Picked non-existent layer. Is picking buffer corrupt?')();\n    }\n  }\n\n  return NO_PICKED_OBJECT;\n}\nexport function getUniqueObjects(_ref2) {\n  let {\n    pickedColors,\n    decodePickingColor\n  } = _ref2;\n  const uniqueColors = new Map();\n\n  if (pickedColors) {\n    for (let i = 0; i < pickedColors.length; i += 4) {\n      const pickedLayerIndex = pickedColors[i + 3] - 1;\n\n      if (pickedLayerIndex >= 0) {\n        const pickedColor = pickedColors.slice(i, i + 4);\n        const colorKey = pickedColor.join(',');\n\n        if (!uniqueColors.has(colorKey)) {\n          const pickedObject = decodePickingColor(pickedColor);\n\n          if (pickedObject) {\n            uniqueColors.set(colorKey, { ...pickedObject,\n              pickedColor\n            });\n          } else {\n            log.error('Picked non-existent layer. Is picking buffer corrupt?')();\n          }\n        }\n      }\n    }\n  }\n\n  return Array.from(uniqueColors.values());\n}","map":null,"metadata":{},"sourceType":"module"}